#!/bin/bash
clear
wmctrl -r :ACTIVE: -N "Applying Build Settings"
NOW=$(date +"%d-%m-%Y")
echo "Current Date : $NOW"
echo "Applying Build Settings"
sleep 1

#CONFIGS
echo "Setting CPU Cores/Threads"
export CPUS=`nproc`
echo "Setting Version Number"
export VER=V5
echo "Setting Defconfig"
export DEFCONFIG=cyanogenmod_zenfone2_defconfig
echo "Setting bzImage Location For FlareM kernel By say99 Of XDA"
export BZIMAGE=arch/x86/boot/bzImage
echo "Enviroment Setup Complete Now Moving To Compiling"

#Build
echo "Cleaning Out Compiled Files"
sleep 1
<<<<<<< HEAD
make clean
=======
sleep $SLEEP
>>>>>>> ebde5ba... Add Barry Allen Governor
wmctrl -r :ACTIVE: -N "Starting Build Process"
echo "Starting Build Process"
export USE_CCACHE=1
sleep 1
if [ -f .config ];
then
   echo ".config exists"
   echo "Continuing To Compiler"
   sleep 1
else
   echo ".config Does Not Exists"
   echo "Compiling From $DEFCONFIG"
   make $DEFCONFIG
   sleep 1
fi
<<<<<<< HEAD
=======
<<<<<<< HEAD
<<<<<<< HEAD
>>>>>>> b65fb2f... add tweaked simpleondemand GPU governor
wmctrl -r :ACTIVE: -N "Compiling FlareM Kernel"
<<<<<<< HEAD
make -j$CPUS
=======

#settings according to my compiler (had set it up in a ugly way :P )

make ARCH=x86_64 -j$CPUS
>>>>>>> 39070a3... Dont upload compiled bzImage
<<<<<<< HEAD
=======
=======
<<<<<<< HEAD
wmctrl -r :ACTIVE: -N "Compiling OctoDex Kernel"
make $EV -j$CPUS
=======
wmctrl -r :ACTIVE: -N "Compiling FlareM Kernel"
make $EV #-j$CPUS
>>>>>>> 84ea23d... Proper Intel Power Clamp Fix ;)
>>>>>>> 45f3966... Proper Intel Power Clamp Fix ;)
=======
wmctrl -r :ACTIVE: -N "Compiling OctoDex Kernel"
make $EV -j$CPUS
>>>>>>> 327f311... add tweaked simpleondemand GPU governor
>>>>>>> b65fb2f... add tweaked simpleondemand GPU governor

if [ -f $BZIMAGE ];
then
   echo "$BZIMAGE exists"
   echo "Compile Complete Continuing To Packing"
   sleep 1
else
   echo "$BZIMAGE Does Not Exists Please Check For Compile Errors"
   echo "Now exiting script"
   sleep 1
   exit 0
fi

#Kernel Packing
wmctrl -r :ACTIVE: -N "FlareM Kernel Packing"
echo "Starting Packing To Recovery Flashable Zip"
cd out/
echo "Removing Old Files"
rm -rf bzImage *.zip
sleep 1
echo "Copying bzImage"
mv ../arch/x86/boot/bzImage bzImage
sleep 1
echo "Compiling FlareM_"$VER".zip"
find . -type f -exec zip FlareM_"$VER".zip {} +
nowf=$(date +"%T")
<<<<<<< HEAD
echo "Completion Time : $nowf"
=======
cd ..
printf "\n\n zip created\n"
rm out/bzImage
printf "cleaned files"
printf "\n\nzip created\n"
end=`date +%s`
runtime=$((end-start))
echo "Completion Time :"
echo "$runtime sec\n"
<<<<<<< HEAD
>>>>>>> 528b5d6... Remove bzImage pt.2
=======

>>>>>>> 327f311... add tweaked simpleondemand GPU governor
